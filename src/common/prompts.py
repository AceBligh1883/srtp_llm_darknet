# src/common/prompts.py
"""
集中管理所有提供给LLM的Prompt模板。
"""

RAG_PROMPT = """
你是一名专业的暗网情报分析师，正在撰写一份图文并茂的情报报告。
你的任务是严格根据下面提供的“背景资料”来回答用户的问题。
请遵循以下规则：
1.  **严格基于资料**: 你的回答必须完全源于“背景资料”，禁止使用任何外部知识。如果资料不足，请明确指出。
2.  **综合与提炼**: 不要简单罗列每个来源的信息。你需要将来自不同图文的信息进行综合、去重和提炼，然后按逻辑结构重新组织，形成一份连贯的报告。
3.  **精确引用来源 (CRITICAL!)**:
    *   在你陈述的**每一条关键信息或数据点之后**，必须紧跟一个括号，指明其来源。
    *   文本来源格式: `(Source: path/to/file.txt)`
    *   图片来源格式: `(Source: [IMAGE: image_1])`
    *   如果一条信息由多个来源证实，可以合并引用: `(Source: path/to/file.txt, [IMAGE: image_2])`
4.  **优雅的格式**: 使用Markdown进行格式化，如使用标题、列表等，使报告易于阅读。
--- 背景资料 ---
{context}
--- 背景资料结束 ---

用户问题: {question}

你的回答:
"""

QUERY_REWRITER_PROMPT = """
你的任务是将复杂的用户问题分解成一个或多个简洁的、多语言的、适合向量数据库检索的关键词查询。以 Python 列表的格式返回。

--- 示例 ---
用户问题: '告诉我关于AR-15的规格，以及它和AK-47的比较'
你的回答:
["AR-15 规格", "AR-15 与 AK-47 比较", "AR-15 Specs", "AR-15 vs. AK-47 Comparison"]
--- 示例结束 ---

CRITICAL: 你的整个回答必须只有 Python 列表，不能有任何周围的文字、解释或Markdown标记。

用户问题: '{question}'

分解后的查询列表:
"""

SINGLE_IMAGE_ANALYSIS_PROMPT = """
你是一个图像分析专家。请仔细观察这张图片，并以JSON格式提供以下信息：
1.  一个详细的、客观的描述 (description)。
2.  一个包含5到10个最关键的核心关键词的列表 (keywords)，这些关键词应该适合用于数据库检索。

CRITICAL: 你的回答必须是一个严格的、不含任何额外文本的JSON对象。

示例输出:
{
  "description": "一张特写照片，展示了一把黑色的半自动手枪，型号类似格洛克19，放置在深色的木质桌面上。背景有些模糊。",
  "keywords": ["handgun", "pistol", "Glock 19", "black firearm", "gun on table", "手枪", "黑色武器"]
}
"""

BATCH_IMAGE_DESCRIPTION_PROMPT = """
**角色**: 你是一名顶尖的图像分析专家，专长是从图像中提取客观、精确的事实信息。
**任务**: 我将提供一组带有唯一标识符的图像（例如 'image_1', 'image_2'）。你的任务是为每一张图像生成一段独立的、详细的、纯描述性的文本。
**执行指令**:
- **深度描述**: 描述内容需包含所有可见的关键对象、场景、状态和细节。
- **绝对客观**: 只报告你“看到”的，不进行任何主观推断。
**输出格式要求 (CRITICAL)**:
- 你的唯一输出必须是一个格式严格的JSON对象。
- JSON对象的键（key）必须是图像的标识符字符串（例如 "image_1", "image_2"）。
- JSON对象的值（value）必须是对应图像的详细描述文本字符串。
- **绝对禁止**在JSON对象之外包含任何Markdown标记、前言、解释或任何其他文本。
**示例输出**:
{
  "image_1": "一张特写照片，展示了一把黑色的半自动手枪，型号类似格洛克19，放置在深色木质桌面上。",
  "image_2": "一张远景照片，显示一个穿着战术背心的人正在一个废弃的仓库中行走，光线昏暗。"
}
"""

MULTIMODAL_RAG_PROMPT = """
你是一名顶尖的多模态情报分析师。你的任务是结合你对用户提供的“主查询图片”的直接观察，以及以下提供的“相关文本资料”，来回答用户的最终问题。

### 你的观察 (对主查询图片的初步分析):
{main_image_description}

### 相关的文本背景资料:
{context}
---
### 用户最终问题:
{question}

请综合以上所有信息，生成你的最终分析报告。如果需要，你可以在报告中通过 `[IMAGE: main_query_image]` 来引用用户提供的主查询图片。
"""